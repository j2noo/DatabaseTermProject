# 항공권 가격 변동 추적 프로그램✈️


## 👩‍👩‍👧‍👦 R&R

| 분야 | 이름 | 포지션 |
| --- | --- | --- |
| 개발 | 박진우 | 🖥️ 크롤링 서버 구축, 크롤러 설계, 데이터베이스 연동 |
| 개발 | 윤선웅 | 💻 파이썬 GUI 설계 및 구축, SQL 작성|

## 1. 동기 및 목적
#### A. 항공권의 과거 가격 변동 정보 파악의 어려움
2023년 5월 코로나19 펜데믹 종료 이후, 여행 수요가 증가하고 있습니다. 대부분의 소비자들이 이용하는 항공권 조회 사이트에서는 검색 당시의 항공권 가격 정보만을 제공합니다. 

그러나 합리적인 소비를 하기 위해서는 과거 항공권 가격의 변동 정보까지 정확하게 알아야 합니다.
즉, 소비자들은 검색 당시의 가격과 과거 가격 변동의 추이를 모두 알고 싶어 하지만, 기존의 사이트에서는 그러한 정보를 제공하지 않는 실정입니다. **그래서 이번 프로젝트에서는 항공권의 과거 가격 변동 정보를 구체적으로 제공하도록 하였습니다.**
<br/><br/>

#### B. 최저가 항공권의 가격 및 예약 시기 파악의 필요성

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/a387bd3c-f627-4189-833e-c54bbc185bdd)

최저가에 항공권을 구매할 수 있는 시기는 언제일까요? 대부분 3~4개월 전 예약하는 항공권이 제일 저렴하다고 알려져 있습니다.

하지만 꼭 그렇지는 않습니다. 항공권은 다양한 변수에 의해 가격이 변동됩니다. 그러므로 최저가를 파악할 수 있는 가장 좋은 정보는 항공권 가격 변동 추이를 나타내는 자료일 것입니다. **그러므로 해당 자료를 통해 사용자는 적절한 항공권 구매 시기 및 최저가 정보를 파악할 수 있을 것입니다.**
<br/><br/>

#### C. GUI를 사용하여 사용자 경험 최적화
양질의 데이터를 수집하는 것은 물론이고, 수집된 데이터를 누구나 활용할 수 있어야 할 것입니다. 복잡한 SQL문을 이용하여 데이터를 조회할 필요 없이, **GUI를 활용하여 누구나 쉽게 항공권의 가격 변동 정보를 조회하는 방법을 구상해 보았습니다.**
<br/><br/><br/>

## 2. 현황 및 문제점 분석
#### A. 과거 항공권 가격의 변동 정보 미제공
![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/270d12a1-26b7-47bd-a5ee-604a1a7570b7)

현재 존재하는 항공권 조회 사이트는 과거 항공권 가격의 변동 정보를 제공하지 않습니다. 왼쪽 사진과 같이 `구글 플라이트`에서 가격 변동 내역을 제공하지만(최근 네이버 항공권도 제공하기 시작했습니다.), 해당 정보는 특정 항공편이 아닌 조회된 노선 전체의 평균치를 제공합니다. 또한 제한적인 몇몇 노선에 대해서만 제공하며 60일보다 오래된 가격 정보는 확인할 수 없습니다. 세부 내역 파악을 위한 구글 플라이트 api도 제공하지 않아 수집된 데이터를 자세히 알 수도 없습니다. 

사용자가 가격 정보의 변동을 알고 싶어 한다면, 오른쪽 사진와 같이 특정 항공노선의 가격 정보의 변동이 있을 때 사용자에게 메일을 보내 알림을 주는 기능을 몇몇 사이트에서 제공합니다. 그러나 이러한 기능은 변화된 가격에 따른 알림일 뿐 적절한 예약 시기를 파악하는데 도움을 주지 않습니다
<br/><br/><br/>

## 3. 기대 효과
#### A.	사용자의 필요에 맞는 세부적인 항공권 가격 변동 정보 파악 가능
가격, 날짜, 항공사, 하나의 항공편 등 다양한 정보를 검색 조건으로 활용하여, 사용자가 원하는 가격 변동 정보를 얻을 수 있습니다.
<br/><br/>

#### B.	최적의 예약 정보 제공을 통한 경제적 이익 및 시간 절약 
직접 수집한 데이터로 가격 변동 추이를 살펴보기 때문에, 최적의 항공권 예약 시기를 파악할 수 있습니다. 해당 정보를 통해 최근 며칠, 몇 달의 최저가를 파악할 수 있고 추가적인 분석을 통해 항공권 가격 예측도 가능할 것이라 생각합니다.
<br/><br/>

#### C.	사용자의 항공권 조회 프로그램 활용 가능성 극대화 
현재 수집된 데이터는 국토교통부에서 제공한 취항률 상위 18개 노선을 대상으로 180일간의 정보를 수집합니다. 사용자의 입맛에 맞게 노선을 조회하거나 조회 기간을 늘리는 등의 수정이 간편하게 이루어집니다. 크롤링 프로세스의 자동화를 통해 누구나 간편하게 프로그램을 다룰 수 있고 SQL을 모르는 사용자도 이용할 수 있습니다.
<br/><br/><br/>

## 4. ERD 설계 및 구축
![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/b62ca390-25f7-484c-80f4-b6144598007e)
<br/><br/><br/>

## 5. 데이터 수집 및 확보 방안
#### A.	데이터 수집 방법
항공권 조회 웹 사이트에서 1일 1회 지정된 18개 노선의 항공권 정보를 최대 183일 이후까지 크롤링을 통해 수집합니다. 하루 평균 수집 데이터의 개수는 약 52000개이며, 평균 소요시간은 약 10시간입니다. 소요시간이 매우 오래 걸리므로, 후술할 클라우드 컴퓨팅 방식을 이용하여 크롤링 서버를 구축하였습니다.

수집하는 정보는 `조사 날짜`, `출발 날짜`, `노선ID`,  `출발 시각`, `도착 시각`, `비행 시간`, `항공사`, `가격`, `카드 정보`이며 `**Flight Ticket**` 테이블의 속성과 일치합니다.

수집된 정보는 flights.csv파일에 매일 누적되며, 날짜 별 로그파일을 통해 프로그램 이상을 파악합니다.
<br/><br/>

#### B.	데이터 수집 소스 선정 
항공권 조회 웹 사이트 한 군데에서, 크롤링을 통해 필요한 정보를 저장합니다. 여러 후보군 중 선정 기준에 따라 정해진 크롤링 대상 페이지는‘네이버 항공권’이며, 다음과 같은 기준에 의하여 선정하였습니다.
-	봇 탐지 프로세스가 존재하지 않는 사이트
-	IP 차단이 발생할 경우 타 Proxy IP 사용으로 우회 가능한 사이트
-	또는 HTTP headers의 user-agent 속성 값 조작 또는 지정으로 우회 가능한 사이트
-	크롤링 속도 향상을 위해 동기적으로 작동하는 웹사이트
  
`네이버 항공권` 봇 탐지 프로세스가 존재하지 않아 별다른 우회 조치가 필요 없고, 동기적으로 작동하는 항공권 조회 사이트는 존재하지 않으므로 후술할 방식으로 크롤링 속도를 향상하였습니다.
<br/><br/>

#### C.	개발 환경 구축 – 크롤링 서버
아마존에서 제공하는 클라우드 컴퓨팅 시스템인 AWS EC2를 사용하였습니다. 
![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/581f47ee-88b5-4e0a-9d9a-b558c91914d6)
-	운영체제 : Ubuntu Server 22.04 LTS (HVM), SSD Volume Type
-	인스턴스 : t2.micro
-	vCPU : 1, 메모리 : 1GiB, 네트워크 : 1Gbps, IMDSv2 : Optional
-	FTP : FileZila - EC2 인스턴스 코드 배포 및 데이터 회수
-	SSH Client : XShell
<br/><br/>

#### D. 	프로세스 자동화 및 스케줄링
비동기 크롤링의 특성상 많은 시간이 소요되므로, 이를 해결하기 위해 다음과 같은 시도를 하였습니다.
-	ssh세션 종료 이후 프로세스를 백그라운드로 실행 – nohup POSIX 명령어 사용
-	selenium webdirver 멀티스레딩 미지원 이슈 - client level 멀티스레딩
-	Unix Job Scheduler – crontab을 사용한 크롤링 스크립트 자동화 
-	파싱 라이브러리 혼용 – bs4, selenium
<br/><br/>

#### E.	데이터 검증 및 자체 평가
1.	신뢰할 수 있는 데이터인가?
크롤링을 통해 실제 가격 정보를 가져오므로 신뢰할 수 있습니다.
2.	지속적으로 확보할 수 있는 데이터인가?
자동화 프로세스 구축으로 매일 데이터를 수집하여 갱신합니다.
3.	데이터의 양은 충분한가?
한 번의 스크립트로 수집되는 데이터의 양은 약 52000개이며, 최대 183일 이후까지 정보를 수집하므로 활용할 수 있는 데이터는 최대 950만개입니다. 이는 18개의 노선에 대한 정보만을 포함하므로, 사용자가 노선을 추가할 경우 더 많은 데이터를 수집 할 수 있습니다.
<br/><br/><br/>

## 6. GUI 설계 및 구현
#### A. 홈 화면
항공권 조회 프로그램 처음 실행 시 나오는 메인 화면입니다. 3개의 자주 사용되는 기능과 사용자가 검색 조건을 설정할 수 있는 기능까지 총 4개의 버튼으로 이루어집니다.

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/3d3bc6dc-884a-44f6-b85c-74980e92a0c6)
<br/><br/>

#### B. 노선 별 항공권 가격 변동 내역 조회 화면
노선 별로 항공권의 가격 변동 내역을 조회할 수 있는 화면입니다.

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/a6de59f0-4e5e-4a2b-afcd-f13a974a2211)
<br/><br/>

#### C. 항공권 별 가격 변동 내역 조회 화면
동일한 항공권의 가격 변동 내역을 조회할 수 있는 화면입니다.   

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/e15e286b-234c-4589-a0e7-ed8838dd7977)
<br/><br/>

#### D. 국가 별 항공권 가격 변동 조회 화면
특정 국가 행 항공권의 가격 변동 내역을 조회할 수 있는 화면입니다.

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/ce64fe6b-64fd-4c13-97a6-6265f627c2a5)
<br/><br/>


#### E. 사용자 지정 항공권 가격 변동 조회 화면
사용자가 모든 검색 조건을 지정할 수 있습니다. 출발지, 목적지, 출발 날짜, 항공사, 출발시각 등의 조건을 비워 두거나 입력하여 검색 조건으로 활용할 수 있습니다. 또한 정렬 순서와 정렬 방식을 설정할 수 있습니다.

![image](https://github.com/j2noo/DatabaseTermProject/assets/77064618/ce4e20d1-140f-4568-b58d-9f0fac8acb5a)
<br/><br/><br/>



## 7. 향후 개발 계획
#### A.	데이터 수집 프로세스 완전 자동화
현재 데이터를 수집하는 크롤링 프로세스는 자동화가 이루어졌습니다. 하지만 자동화를 위한 명령어를 입력하는 과정이나, 수집된 파일을 가져오는 과정은 FTP를 이용하여 직접 가져와야 합니다. 이러한 과정들 전부 자동화하여 사용자의 편의성을 극대화할 예정입니다.
<br/><br/>

#### B.	UI를 통한 노선 정보 및 수집 정보 변경
현재 노선 정보를 변경하거나 수집 정보를 변경하려면 코드를 수정해야 합니다. 이러한 과정 또한 UI를 통해 접근할 수 있게 구현함으로써 역시 사용자의 편의성을 극대화할 것입니다.
<br/><br/>

#### C.	웹앱 및 모바일 어플리케이션 구축을 통한 온라인 접속 및 실생활 적용
현재 제공하는 GUI는 파이썬의 tkinter 라이브러리를 사용한 스크립트 파일입니다. 해당 스크립트를 실행파일로 만들 뿐 아니라, 크롤링 및 백엔드 서버를 구축하여 사용자가 온라인으로 접속하여 활용할 수 있도록 적용 범위를 늘릴 예정입니다.
<br/><br/>

#### D.	시각자료 제공 등 UX 개선
사용자가 정보를 한눈에 파악하기 쉽도록 가격 변동 그래프 등의 시작자료를 제공함으로써 GUI제공의 목적을 살릴 예정입니다.
<br/><br/>

#### E. MLOps 및 시계열 분석을 통한 가격 예측 정보 제공
수집된 데이터의 분석을 통한 항공권 가격 예측 정보를 제공할 예정입니다.
<br/><br/><br/>


##  8. 환경 설정

####  크롬 및 크롬드라이버 설치
```
wget -q -O - https://dl-ssl.google.com/linux/linux_signing_key.pub | sudo apt-key add -
echo 'deb [arch=amd64] http://dl.google.com/linux/chrome/deb/ stable main' | sudo tee /etc/apt/sources.list.d/google-chrome.list
sudo apt-get update 
sudo apt-get install google-chrome-stable

sudo apt install unzip
/* 크롬 최신버전 확인하여 크롬드라이버 다운받을것*/
wget https://chromedriver.storage.googleapis.com/113.0.5672.63/chromedriver_linux64.zip
unzip chromedriver_linux64.zipls
```
<br/><br/>

####  파이썬 설치 버전 확인 및 라이브러리 설치
```
sudo apt-get update
python3 --version /* 버전 확인! 없으면 설치하기 Python 3.10.6 */
sudo apt-get install python3-pip
pip install selenium
pip install asyncio
pip install beatifulsoup4
pip install crontab
# 필요 라이브러리 : selenium,asyncio,beautifulsoup4,crontab
```

### 2-3) 프로세스 자동화
```
crontab e
0 16 * * * /usr/bin/python3 /home/ubuntu/crawl/crawl.py
```
